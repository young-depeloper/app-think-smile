<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Think&Smile - –ò–∑—É—á–µ–Ω–∏–µ —Å–ª–æ–≤</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#4255ff">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Think&Smile">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary: #4255ff;
            --primary-light: #e8ebff;
            --secondary: #ffcd1f;
            --dark: #303545;
            --light: #f6f7fb;
            --success: #4caf50;
            --danger: #ff5252;
            --gray: #939bb4;
            --bg-color: #f6f7fb;
            --text-color: #303545;
            --card-bg: white;
            --sidebar-bg: white;
            --border-color: #e0e0e0;
            --easy-color: #4caf50;
            --medium-color: #ff9800;
            --hard-color: #f44336;
        }

        [data-theme="dark"] {
            --bg-color: #1a1a1a;
            --text-color: #ffffff;
            --card-bg: #2d2d2d;
            --sidebar-bg: #252525;
            --border-color: #404040;
            --light: #2d2d2d;
            --dark: #ffffff;
            --gray: #a0a0a0;
            --primary-light: #2d3748;
            --easy-color: #388e3c;
            --medium-color: #f57c00;
            --hard-color: #d32f2f;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            min-height: 100vh;
            transition: all 0.3s ease;
        }

        /* –°–∞–π–¥–±–∞—Ä */
        .sidebar {
            width: 280px;
            background-color: var(--sidebar-bg);
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 20px;
            overflow-y: auto;
            transition: all 0.3s;
            border-right: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--border-color);
        }

        .logo h1 {
            font-size: 24px;
            color: var(--primary);
            margin-left: 10px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background-color: var(--primary);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .theme-switcher {
            margin-left: auto;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text-color);
        }

        .create-set-btn {
            background-color: var(--primary);
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 8px;
            width: 100%;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 10px;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .create-set-btn:hover {
            background-color: #3241cc;
        }

        .create-set-btn i {
            margin-right: 8px;
        }

        .sets-list {
            margin-top: 20px;
        }

        .set-item {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .set-item:hover {
            background-color: var(--primary-light);
        }

        .set-item.active {
            background-color: var(--primary-light);
            color: var(--primary);
            font-weight: 600;
        }

        .set-icon {
            width: 24px;
            height: 24px;
            background-color: var(--secondary);
            border-radius: 4px;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .set-actions {
            margin-left: auto;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .set-item:hover .set-actions {
            opacity: 1;
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            border-radius: 4px;
            color: var(--gray);
            transition: color 0.2s;
        }

        .action-btn:hover {
            color: var(--text-color);
        }

        .delete-btn:hover {
            color: var(--danger);
        }

        /* –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h2 {
            font-size: 28px;
        }

        .header-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .mode-selector {
            display: flex;
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
        }

        .mode-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .mode-btn.active {
            background-color: var(--primary);
            color: white;
        }

        /* –ù–æ–≤—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ —Å–ø–∏—Å–∫–∞ –∏ —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ */
        .view-mode-selector {
            display: flex;
            background-color: var(--card-bg);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border-color);
            margin-left: 10px;
        }

        .view-mode-btn {
            padding: 8px 16px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .view-mode-btn.active {
            background-color: var(--primary);
            color: white;
        }

        /* –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è */
        .search-filter-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .search-input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 8px 16px;
            background: none;
            border: 2px solid var(--primary-light);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .filter-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .filter-btn.easy.active {
            background-color: var(--easy-color);
            border-color: var(--easy-color);
        }

        .filter-btn.medium.active {
            background-color: var(--medium-color);
            border-color: var(--medium-color);
        }

        .filter-btn.hard.active {
            background-color: var(--hard-color);
            border-color: var(--hard-color);
        }

        .search-results-info {
            margin-top: 10px;
            color: var(--gray);
            font-size: 14px;
        }

        /* –ö–∞—Ä—Ç–æ—á–∫–∏ */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .card.easy {
            border-left: 4px solid var(--easy-color);
        }

        .card.medium {
            border-left: 4px solid var(--medium-color);
        }

        .card.hard {
            border-left: 4px solid var(--hard-color);
        }

        .card-term {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-definition {
            color: var(--gray);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .card-header-left {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-difficulty {
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            background-color: var(--primary-light);
            color: var(--primary);
        }

        .srs-stage {
            font-size: 10px;
            padding: 2px 6px;
            border-radius: 8px;
            background-color: var(--success);
            color: white;
        }

        .card-actions {
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .card:hover .card-actions {
            opacity: 1;
        }

        .transcription {
            color: var(--primary);
            font-size: 14px;
            font-style: italic;
            margin: 5px 0;
        }

        .card-audio-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            color: var(--primary);
            transition: all 0.2s;
            font-size: 16px;
        }

        .card-audio-btn:hover {
            background-color: var(--primary-light);
            transform: scale(1.1);
        }

        .difficulty-selector {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }

        .difficulty-btn {
            background: none;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .difficulty-btn.easy {
            color: var(--easy-color);
            border: 1px solid var(--easy-color);
        }

        .difficulty-btn.easy.active {
            background-color: var(--easy-color);
            color: white;
        }

        .difficulty-btn.medium {
            color: var(--medium-color);
            border: 1px solid var(--medium-color);
        }

        .difficulty-btn.medium.active {
            background-color: var(--medium-color);
            color: white;
        }

        .difficulty-btn.hard {
            color: var(--hard-color);
            border: 1px solid var(--hard-color);
        }

        .difficulty-btn.hard.active {
            background-color: var(--hard-color);
            color: white;
        }

        .add-card-btn {
            background-color: transparent;
            border: 2px dashed var(--gray);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--gray);
        }

        .add-card-btn:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        .add-card-btn i {
            font-size: 24px;
            margin-bottom: 10px;
        }

        /* –°—Ç–∏–ª–∏ –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ */
        .cards-list {
            display: none;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 30px;
        }

        .list-item {
            background-color: var(--card-bg);
            border-radius: 8px;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }

        .list-item:hover {
            background-color: var(--primary-light);
        }

        .list-item.easy {
            border-left: 4px solid var(--easy-color);
        }

        .list-item.medium {
            border-left: 4px solid var(--medium-color);
        }

        .list-item.hard {
            border-left: 4px solid var(--hard-color);
        }

        .list-item-content {
            display: flex;
            align-items: center;
            gap: 20px;
            flex: 1;
        }

        .list-term {
            font-weight: 600;
            font-size: 16px;
            min-width: 150px;
        }

        .list-transcription {
            color: var(--primary);
            font-size: 14px;
            font-style: italic;
            min-width: 120px;
        }

        .list-definition {
            color: var(--gray);
            flex: 1;
        }

        .list-actions {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .audio-btn-small {
            background: none;
            border: none;
            cursor: pointer;
            padding: 5px;
            border-radius: 4px;
            color: var(--primary);
            transition: all 0.2s;
            font-size: 16px;
        }

        .audio-btn-small:hover {
            background-color: var(--primary-light);
            transform: scale(1.1);
        }

        /* –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */
        .stats-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .stats-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }

        .stat-card {
            background-color: var(--light);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary);
            margin-bottom: 5px;
        }

        .stat-label {
            color: var(--gray);
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: var(--border-color);
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success);
            transition: width 0.3s ease;
        }

        /* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            width: 500px;
            max-width: 90%;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            font-size: 20px;
            color: var(--text-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--gray);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 16px;
            background-color: var(--card-bg);
            color: var(--text-color);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 30px;
        }

        .btn {
            padding: 10px 20px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .btn-primary {
            background-color: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background-color: #3241cc;
        }

        .btn-secondary {
            background-color: var(--light);
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: var(--border-color);
        }

        .btn-danger {
            background-color: var(--danger);
            color: white;
        }

        .btn-danger:hover {
            background-color: #e04141;
        }

        .btn-success {
            background-color: var(--success);
            color: white;
        }

        .btn-success:hover {
            background-color: #3d8b40;
        }

        /* –†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è */
        .study-container {
            display: none;
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            border: 1px solid var(--border-color);
        }

        .study-container.active {
            display: block;
        }

        .study-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .study-header h3 {
            font-size: 24px;
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .study-progress {
            color: var(--gray);
        }

        .study-type-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .study-type-btn {
            padding: 8px 16px;
            background: none;
            border: 2px solid var(--primary-light);
            border-radius: 20px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
            color: var(--text-color);
        }

        .study-type-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .question {
            font-size: 24px;
            text-align: center;
            margin-bottom: 30px;
            min-height: 60px;
            color: var(--text-color);
        }

        .audio-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            margin-left: 10px;
            color: var(--primary);
            transition: transform 0.2s;
        }

        .audio-btn:hover {
            transform: scale(1.1);
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            background-color: var(--light);
            border: none;
            border-radius: 8px;
            padding: 15px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.2s;
            color: var(--text-color);
            border: 1px solid var(--border-color);
        }

        .option:hover {
            background-color: var(--primary-light);
        }

        .option.correct {
            background-color: var(--success);
            color: white;
        }

        .option.incorrect {
            background-color: var(--danger);
            color: white;
        }

        .study-actions {
            display: flex;
            justify-content: space-between;
        }

        .srs-rating-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-top: 20px;
        }

        .srs-rating-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s;
        }

        .srs-rating-btn.again {
            background-color: var(--danger);
            color: white;
        }

        .srs-rating-btn.hard {
            background-color: var(--medium-color);
            color: white;
        }

        .srs-rating-btn.good {
            background-color: var(--success);
            color: white;
        }

        .srs-rating-btn.easy {
            background-color: var(--primary);
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--border-color);
        }

        .empty-state h3 {
            margin-bottom: 10px;
            color: var(--text-color);
        }

        .warning-message {
            color: var(--danger);
            font-size: 14px;
            margin-top: 5px;
            display: none;
        }

        /* –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–Ω–∏–∑—É —ç–∫—Ä–∞–Ω–∞ */
        .notification {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            z-index: 1001;
            transition: transform 0.3s, opacity 0.3s;
            opacity: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .notification.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .notification.success {
            background-color: var(--success);
        }

        .notification.error {
            background-color: var(--danger);
        }

        .notification.info {
            background-color: var(--primary);
        }

        /* –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ */
        .difficult-words {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .difficult-words h3 {
            margin-bottom: 15px;
            color: var(--text-color);
        }

        .difficult-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .difficult-word {
            background-color: var(--danger);
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
            cursor: pointer;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å */
        @media (max-width: 768px) {
            body {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                padding: 15px;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .options {
                grid-template-columns: 1fr;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
                flex-wrap: wrap;
            }

            .search-box {
                flex-direction: column;
            }

            .filter-buttons {
                justify-content: center;
            }

            .view-mode-selector {
                margin-left: 0;
                margin-top: 10px;
            }

            .list-item-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .list-term, .list-transcription {
                min-width: auto;
            }

            .study-type-selector {
                flex-direction: column;
                align-items: center;
            }

            .srs-rating-buttons {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <!-- –°–∞–π–¥–±–∞—Ä -->
    <div class="sidebar">
        <div class="logo">
            <div class="logo-icon">T&S</div>
            <h1>Think&Smile</h1>
            <button class="theme-switcher" id="themeSwitcher">üåô</button>
        </div>
        
        <button class="create-set-btn" id="createSetBtn">
            <i>+</i> –°–æ–∑–¥–∞—Ç—å –Ω–∞–±–æ—Ä
        </button>

        <button class="create-set-btn" id="addPredefinedSetBtn" style="background-color: var(--success);">
            <i>üìö</i> –ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã
        </button>
        
        <div class="sets-list" id="setsList">
            <!-- –ù–∞–±–æ—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
    </div>
    
    <!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
    <div class="main-content">
        <div class="header">
            <h2 id="currentSetName">–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä</h2>
            <div class="header-actions">
                <div class="mode-selector">
                    <button class="mode-btn active" id="cardsModeBtn">–ö–∞—Ä—Ç–æ—á–∫–∏</button>
                    <button class="mode-btn" id="studyModeBtn">–ó–∞—É—á–∏–≤–∞–Ω–∏–µ</button>
                    <button class="mode-btn" id="statsModeBtn">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                </div>
                <div class="view-mode-selector" id="viewModeSelector" style="display: none;">
                    <button class="view-mode-btn active" data-view="cards">
                        <span>üÉè</span> –ö–∞—Ä—Ç–æ—á–∫–∏
                    </button>
                    <button class="view-mode-btn" data-view="list">
                        <span>üìã</span> –°–ø–∏—Å–æ–∫
                    </button>
                </div>
                <div class="export-import">
                    <button class="btn btn-secondary" id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç</button>
                    <button class="btn btn-secondary" id="importBtn">–ò–º–ø–æ—Ä—Ç</button>
                </div>
            </div>
        </div>

        <!-- –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è -->
        <div class="search-filter-container" id="searchFilterContainer" style="display: none;">
            <div class="search-box">
                <input type="text" id="searchInput" class="search-input" placeholder="–ü–æ–∏—Å–∫ –ø–æ —Å–ª–æ–≤–∞–º –∏ –ø–µ—Ä–µ–≤–æ–¥–∞–º...">
                <button class="btn btn-secondary" id="clearSearchBtn">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
            <div class="filter-buttons">
                <button class="filter-btn active" data-filter="all">–í—Å–µ —Å–ª–æ–≤–∞</button>
                <button class="filter-btn easy" data-filter="easy">–õ–µ–≥–∫–∏–µ</button>
                <button class="filter-btn medium" data-filter="medium">–°—Ä–µ–¥–Ω–∏–µ</button>
                <button class="filter-btn hard" data-filter="hard">–°–ª–æ–∂–Ω—ã–µ</button>
            </div>
            <div class="search-results-info" id="searchResultsInfo">
                –ù–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: 0
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div class="cards-container" id="cardsContainer">
            <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>

        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ø–∏—Å–∫–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ -->
        <div class="cards-list" id="cardsList">
            <!-- –°–ø–∏—Å–æ–∫ –∫–∞—Ä—Ç–æ—á–µ–∫ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ -->
        <div class="stats-container" id="statsContainer" style="display: none;">
            <div class="stats-header">
                <h3>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è</h3>
            </div>
            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-value" id="totalCards">0</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –∫–∞—Ä—Ç–æ—á–µ–∫</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="learnedCards">0</div>
                    <div class="stat-label">–ò–∑—É—á–µ–Ω–æ</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="learnedProgress" style="width: 0%"></div>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="difficultCards">0</div>
                    <div class="stat-label">–°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="successRate">0%</div>
                    <div class="stat-label">–£—Å–ø–µ—à–Ω–æ—Å—Ç—å</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="dueCards">0</div>
                    <div class="stat-label">–î–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="masteredCards">0</div>
                    <div class="stat-label">–£—Å–≤–æ–µ–Ω–æ</div>
                </div>
            </div>
            
            <div class="difficult-words" id="difficultWordsSection" style="display: none; margin-top: 20px;">
                <h3>–°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è</h3>
                <div class="difficult-list" id="difficultWordsList">
                    <!-- –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                </div>
            </div>
        </div>
        
        <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∂–∏–º–∞ –∑–∞—É—á–∏–≤–∞–Ω–∏—è -->
        <div class="study-container" id="studyContainer">
            <div class="study-header">
                <h3>–†–µ–∂–∏–º –∑–∞—É—á–∏–≤–∞–Ω–∏—è</h3>
                <div class="study-type-selector">
                    <button class="study-type-btn active" data-type="mixed">–°–º–µ—à–∞–Ω–Ω—ã–π</button>
                    <button class="study-type-btn" data-type="en-ru">–ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí –†—É—Å—Å–∫–∏–π</button>
                    <button class="study-type-btn" data-type="ru-en">–†—É—Å—Å–∫–∏–π ‚Üí –ê–Ω–≥–ª–∏–π—Å–∫–∏–π</button>
                    <button class="study-type-btn" data-type="typing">–ü–µ—á–∞—Ç—å</button>
                    <button class="study-type-btn" data-type="audio">–û–∑–≤—É—á–∫–∞</button>
                    <button class="study-type-btn" data-type="difficult">–°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞</button>
                    <button class="study-type-btn" data-type="srs">–ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ</button>
                </div>
                <div class="study-progress" id="studyProgress">–í–æ–ø—Ä–æ—Å 1 –∏–∑ 4</div>
            </div>
            
            <div class="question" id="studyQuestion">
                –ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "apple"?
            </div>
            
            <div class="options" id="studyOptions">
                <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –∑–¥–µ—Å—å -->
            </div>

            <div class="typing-input-container" id="typingInputContainer" style="display: none; text-align: center; margin-bottom: 20px;">
                <input type="text" id="typingAnswer" class="form-control" style="max-width: 300px; margin: 0 auto;" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥...">
                <button class="btn btn-primary" id="checkTypingAnswer" style="margin-top: 10px;">–ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
            </div>

            <div class="audio-container" id="audioContainer" style="display: none; text-align: center; margin-bottom: 20px;">
                <p style="margin-bottom: 15px; font-size: 18px;">–ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ —Å–ª–æ–≤–æ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥:</p>
                <button class="audio-btn" id="playAudioBtn" title="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å —Å–ª–æ–≤–æ">üîä</button>
                <div class="options" id="audioOptions" style="margin-top: 20px;">
                    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∞—É–¥–∏–æ —Ä–µ–∂–∏–º–∞ -->
                </div>
            </div>

            <div class="srs-rating-buttons" id="srsRatingButtons" style="display: none;">
                <button class="srs-rating-btn again" data-rating="again">–°–Ω–æ–≤–∞</button>
                <button class="srs-rating-btn hard" data-rating="hard">–¢—Ä—É–¥–Ω–æ</button>
                <button class="srs-rating-btn good" data-rating="good">–•–æ—Ä–æ—à–æ</button>
                <button class="srs-rating-btn easy" data-rating="easy">–õ–µ–≥–∫–æ</button>
            </div>
            
            <div class="study-actions">
                <button class="btn btn-secondary" id="prevQuestionBtn">–ù–∞–∑–∞–¥</button>
                <button class="btn btn-primary" id="nextQuestionBtn">–î–∞–ª–µ–µ</button>
            </div>
        </div>
        
        <!-- –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –ø—É—Å—Ç–æ–º –Ω–∞–±–æ—Ä–µ -->
        <div class="empty-state" id="emptyState">
            <i>üìö</i>
            <h3>–ù–∞–±–æ—Ä –ø—É—Å—Ç</h3>
            <p>–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å –∏–∑—É—á–µ–Ω–∏–µ</p>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –Ω–∞–±–æ—Ä–∞ -->
    <div class="modal" id="createSetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π –Ω–∞–±–æ—Ä</h3>
                <button class="close-btn" id="closeCreateSetModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="setName">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞</label>
                <input type="text" id="setName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –§—Ä—É–∫—Ç—ã">
                <div class="warning-message" id="setNameWarning">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelCreateSet">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveSet">–°–æ–∑–¥–∞—Ç—å</button>
            </div>
        </div>
    </div>
    
    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è/—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ -->
    <div class="modal" id="createCardModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="cardModalTitle">–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</h3>
                <button class="close-btn" id="closeCreateCardModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="cardTerm">–¢–µ—Ä–º–∏–Ω (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π)</label>
                <input type="text" id="cardTerm" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, apple">
                <div class="warning-message" id="cardTermWarning">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ —Ç–µ—Ä–º–∏–Ω</div>
            </div>
            <div class="form-group">
                <label for="cardDefinition">–û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ (—Ä—É—Å—Å–∫–∏–π)</label>
                <input type="text" id="cardDefinition" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, —è–±–ª–æ–∫–æ">
                <div class="warning-message" id="cardDefinitionWarning">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelCreateCard">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveCard">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–±–æ—Ä–∞ -->
    <div class="modal" id="editSetModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä</h3>
                <button class="close-btn" id="closeEditSetModal">&times;</button>
            </div>
            <div class="form-group">
                <label for="editSetName">–ù–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞</label>
                <input type="text" id="editSetName" class="form-control" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, –§—Ä—É–∫—Ç—ã">
                <div class="warning-message" id="editSetNameWarning">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelEditSet">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="saveEditSet">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è -->
    <div class="modal" id="confirmDeleteModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="deleteModalTitle">–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ —É–¥–∞–ª–µ–Ω–∏—è</h3>
                <button class="close-btn" id="closeConfirmDeleteModal">&times;</button>
            </div>
            <div class="form-group">
                <p id="deleteModalMessage">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –Ω–∞–±–æ—Ä? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.</p>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelDelete">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-danger" id="confirmDelete">–£–¥–∞–ª–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∞ -->
    <div class="modal" id="exportModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–≠–∫—Å–ø–æ—Ä—Ç –Ω–∞–±–æ—Ä–∞</h3>
                <button class="close-btn" id="closeExportModal">&times;</button>
            </div>
            <div class="form-group">
                <label>–§–æ—Ä–º–∞—Ç —ç–∫—Å–ø–æ—Ä—Ç–∞:</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-secondary export-format-btn active" data-format="json">JSON</button>
                    <button class="btn btn-secondary export-format-btn" data-format="txt">TXT</button>
                </div>
                <label for="exportContent">–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:</label>
                <textarea id="exportContent" class="form-control" rows="10" readonly style="resize: vertical; font-family: monospace;"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelExport">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="downloadExport">–°–∫–∞—á–∞—Ç—å</button>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∏–º–ø–æ—Ä—Ç–∞ -->
    <div class="modal" id="importModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>–ò–º–ø–æ—Ä—Ç –Ω–∞–±–æ—Ä–∞</h3>
                <button class="close-btn" id="closeImportModal">&times;</button>
            </div>
            <div class="form-group">
                <label>–§–æ—Ä–º–∞—Ç –∏–º–ø–æ—Ä—Ç–∞:</label>
                <div style="display: flex; gap: 10px; margin-bottom: 15px;">
                    <button class="btn btn-secondary import-format-btn active" data-format="json">JSON</button>
                    <button class="btn btn-secondary import-format-btn" data-format="txt">TXT</button>
                </div>
                <label>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–∞–π–ª –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞:</label>
                <input type="file" id="importFileInput" class="form-control" accept=".json,.txt">
                <div class="warning-message" id="importFileWarning" style="display: none;"></div>
            </div>
            <div class="form-group" id="importPreview" style="display: none;">
                <label>–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –Ω–∞–±–æ—Ä–∞:</label>
                <div style="background: var(--light); padding: 15px; border-radius: 8px; border: 1px solid var(--border-color);">
                    <strong>–ù–∞–∑–≤–∞–Ω–∏–µ:</strong> <span id="previewSetName"></span><br>
                    <strong>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–∞—Ä—Ç–æ—á–µ–∫:</strong> <span id="previewCardCount"></span><br>
                    <strong>–ü–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞:</strong> <span id="previewFirstWords"></span>
                </div>
            </div>
            <div class="form-group" id="importNameSection" style="display: none;">
                <label for="importSetName">–ù–∞–∑–≤–∞–Ω–∏–µ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º–æ–≥–æ –Ω–∞–±–æ—Ä–∞</label>
                <input type="text" id="importSetName" class="form-control" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞">
                <div class="warning-message" id="importNameWarning" style="display: none;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelImport">–û—Ç–º–µ–Ω–∞</button>
                <button class="btn btn-primary" id="confirmImport" disabled>–ò–º–ø–æ—Ä—Ç</button>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω–Ω—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        let sets = JSON.parse(localStorage.getItem('thinkSmileSets')) || [];
        let currentSetId = null;
        let currentMode = 'cards'; // 'cards', 'study' –∏–ª–∏ 'stats'
        let currentViewMode = 'cards'; // 'cards' –∏–ª–∏ 'list'
        let currentQuestionIndex = 0;
        let studyQuestions = [];
        let currentStudyType = 'mixed';
        let editingCardId = null;
        let editingSetId = null;
        let speechSynthesis = window.speechSynthesis;
        let isDarkTheme = localStorage.getItem('thinkSmileDarkTheme') === 'true';
        let deleteSetId = null;
        let importSetData = null;

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        let currentSearchQuery = '';
        let currentFilter = 'all';

        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞/–∏–º–ø–æ—Ä—Ç–∞
        let currentExportFormat = 'json';
        let currentImportFormat = 'json';

        // –ê–ª–≥–æ—Ä–∏—Ç–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
        const SRSStages = {
            0: { name: '–ù–æ–≤–æ–µ', interval: 1, factor: 2.5 },
            1: { name: '–ò–∑—É—á–∞–µ—Ç—Å—è', interval: 1, factor: 2.5 },
            2: { name: '–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', interval: 2, factor: 2.0 },
            3: { name: '–ó–∞–∫—Ä–µ–ø–ª–µ–Ω–∏–µ', interval: 4, factor: 1.8 },
            4: { name: '–£—Å–≤–æ–µ–Ω–æ', interval: 7, factor: 1.5 }
        };

        // –ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã —Å–ª–æ–≤
        const predefinedSets = [
            {
                id: 'predefined_top100',
                name: '–¢–æ–ø-100 –∞–Ω–≥–ª–∏–π—Å–∫–∏—Ö —Å–ª–æ–≤',
                predefined: true,
                cards: [
                    { term: 'the', definition: '–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∞—Ä—Ç–∏–∫–ª—å', transcription: '[√∞…ô]' },
                    { term: 'be', definition: '–±—ã—Ç—å', transcription: '[biÀê]' },
                    { term: 'to', definition: '–∫, –≤', transcription: '[tuÀê]' },
                    { term: 'of', definition: '–∏–∑, –æ—Ç', transcription: '[…ív]' },
                    { term: 'and', definition: '–∏', transcription: '[√¶nd]' },
                    { term: 'a', definition: '–Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –∞—Ä—Ç–∏–∫–ª—å', transcription: '[…ô]' },
                    { term: 'in', definition: '–≤', transcription: '[…™n]' },
                    { term: 'that', definition: '—Ç–æ—Ç, —á—Ç–æ', transcription: '[√∞√¶t]' },
                    { term: 'have', definition: '–∏–º–µ—Ç—å', transcription: '[h√¶v]' },
                    { term: 'I', definition: '—è', transcription: '[a…™]' },
                    { term: 'it', definition: '–æ–Ω–æ, —ç—Ç–æ', transcription: '[…™t]' },
                    { term: 'for', definition: '–¥–ª—è', transcription: '[f…îÀêr]' },
                    { term: 'not', definition: '–Ω–µ', transcription: '[n…ít]' },
                    { term: 'on', definition: '–Ω–∞', transcription: '[…ín]' },
                    { term: 'with', definition: '—Å', transcription: '[w…™√∞]' },
                    { term: 'he', definition: '–æ–Ω', transcription: '[hiÀê]' },
                    { term: 'as', definition: '–∫–∞–∫, –≤ –∫–∞—á–µ—Å—Ç–≤–µ', transcription: '[√¶z]' },
                    { term: 'you', definition: '—Ç—ã, –≤—ã', transcription: '[juÀê]' },
                    { term: 'do', definition: '–¥–µ–ª–∞—Ç—å', transcription: '[duÀê]' },
                    { term: 'at', definition: '—É, –≤', transcription: '[√¶t]' }
                ]
            },
            {
                id: 'predefined_food',
                name: '–ï–¥–∞ –∏ –Ω–∞–ø–∏—Ç–∫–∏',
                predefined: true,
                cards: [
                    { term: 'apple', definition: '—è–±–ª–æ–∫–æ', transcription: '[Àà√¶p.…ôl]' },
                    { term: 'banana', definition: '–±–∞–Ω–∞–Ω', transcription: '[b…ôÀàn…ëÀê.n…ô]' },
                    { term: 'orange', definition: '–∞–ø–µ–ª—å—Å–∏–Ω', transcription: '[Àà…ír.…™nd í]' },
                    { term: 'bread', definition: '—Ö–ª–µ–±', transcription: '[bred]' },
                    { term: 'water', definition: '–≤–æ–¥–∞', transcription: '[Ààw…îÀê.t…ôr]' },
                    { term: 'coffee', definition: '–∫–æ—Ñ–µ', transcription: '[Ààk…íf.i]' },
                    { term: 'tea', definition: '—á–∞–π', transcription: '[tiÀê]' },
                    { term: 'milk', definition: '–º–æ–ª–æ–∫–æ', transcription: '[m…™lk]' },
                    { term: 'meat', definition: '–º—è—Å–æ', transcription: '[miÀêt]' },
                    { term: 'fish', definition: '—Ä—ã–±–∞', transcription: '[f…™ É]' },
                    { term: 'vegetables', definition: '–æ–≤–æ—â–∏', transcription: '[Ààved í.t…ô.b…ôlz]' },
                    { term: 'fruit', definition: '—Ñ—Ä—É–∫—Ç—ã', transcription: '[fruÀêt]' },
                    { term: 'rice', definition: '—Ä–∏—Å', transcription: '[ra…™s]' },
                    { term: 'pasta', definition: '–ø–∞—Å—Ç–∞', transcription: '[Ààp√¶s.t…ô]' },
                    { term: 'cheese', definition: '—Å—ã—Ä', transcription: '[t ÉiÀêz]' }
                ]
            },
            {
                id: 'predefined_family',
                name: '–°–µ–º—å—è –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è',
                predefined: true,
                cards: [
                    { term: 'family', definition: '—Å–µ–º—å—è', transcription: '[Ààf√¶m.…ôl.i]' },
                    { term: 'mother', definition: '–º–∞—Ç—å', transcription: '[Ààm å√∞.…ôr]' },
                    { term: 'father', definition: '–æ—Ç–µ—Ü', transcription: '[Ààf…ëÀê.√∞…ôr]' },
                    { term: 'parents', definition: '—Ä–æ–¥–∏—Ç–µ–ª–∏', transcription: '[Ààpe…ô.r…ônts]' },
                    { term: 'brother', definition: '–±—Ä–∞—Ç', transcription: '[Ààbr å√∞.…ôr]' },
                    { term: 'sister', definition: '—Å–µ—Å—Ç—Ä–∞', transcription: '[Ààs…™s.t…ôr]' },
                    { term: 'son', definition: '—Å—ã–Ω', transcription: '[s ån]' },
                    { term: 'daughter', definition: '–¥–æ—á—å', transcription: '[Ààd…îÀê.t…ôr]' },
                    { term: 'children', definition: '–¥–µ—Ç–∏', transcription: '[Ààt É…™l.dr…ôn]' },
                    { term: 'grandmother', definition: '–±–∞–±—É—à–∫–∞', transcription: '[Àà…°r√¶n.m å√∞.…ôr]' },
                    { term: 'grandfather', definition: '–¥–µ–¥—É—à–∫–∞', transcription: '[Àà…°r√¶n.f…ëÀê.√∞…ôr]' },
                    { term: 'friend', definition: '–¥—Ä—É–≥', transcription: '[frend]' },
                    { term: 'husband', definition: '–º—É–∂', transcription: '[Ààh åz.b…ônd]' },
                    { term: 'wife', definition: '–∂–µ–Ω–∞', transcription: '[wa…™f]' }
                ]
            }
        ];

        // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
        const setsList = document.getElementById('setsList');
        const cardsContainer = document.getElementById('cardsContainer');
        const cardsList = document.getElementById('cardsList');
        const studyContainer = document.getElementById('studyContainer');
        const statsContainer = document.getElementById('statsContainer');
        const emptyState = document.getElementById('emptyState');
        const currentSetName = document.getElementById('currentSetName');
        const createSetBtn = document.getElementById('createSetBtn');
        const createSetModal = document.getElementById('createSetModal');
        const closeCreateSetModal = document.getElementById('closeCreateSetModal');
        const cancelCreateSet = document.getElementById('cancelCreateSet');
        const saveSet = document.getElementById('saveSet');
        const setNameInput = document.getElementById('setName');
        const setNameWarning = document.getElementById('setNameWarning');
        const createCardModal = document.getElementById('createCardModal');
        const cardModalTitle = document.getElementById('cardModalTitle');
        const closeCreateCardModal = document.getElementById('closeCreateCardModal');
        const cancelCreateCard = document.getElementById('cancelCreateCard');
        const saveCard = document.getElementById('saveCard');
        const cardTermInput = document.getElementById('cardTerm');
        const cardTermWarning = document.getElementById('cardTermWarning');
        const cardDefinitionInput = document.getElementById('cardDefinition');
        const cardDefinitionWarning = document.getElementById('cardDefinitionWarning');
        const editSetModal = document.getElementById('editSetModal');
        const editSetName = document.getElementById('editSetName');
        const editSetNameWarning = document.getElementById('editSetNameWarning');
        const closeEditSetModal = document.getElementById('closeEditSetModal');
        const cancelEditSet = document.getElementById('cancelEditSet');
        const saveEditSet = document.getElementById('saveEditSet');
        const cardsModeBtn = document.getElementById('cardsModeBtn');
        const studyModeBtn = document.getElementById('studyModeBtn');
        const statsModeBtn = document.getElementById('statsModeBtn');
        const viewModeSelector = document.getElementById('viewModeSelector');
        const viewModeButtons = document.querySelectorAll('.view-mode-btn');
        const studyQuestion = document.getElementById('studyQuestion');
        const studyOptions = document.getElementById('studyOptions');
        const studyProgress = document.getElementById('studyProgress');
        const prevQuestionBtn = document.getElementById('prevQuestionBtn');
        const nextQuestionBtn = document.getElementById('nextQuestionBtn');
        const studyTypeButtons = document.querySelectorAll('.study-type-btn');
        const typingInputContainer = document.getElementById('typingInputContainer');
        const typingAnswer = document.getElementById('typingAnswer');
        const checkTypingAnswer = document.getElementById('checkTypingAnswer');
        const audioContainer = document.getElementById('audioContainer');
        const playAudioBtn = document.getElementById('playAudioBtn');
        const audioOptions = document.getElementById('audioOptions');
        const confirmDeleteModal = document.getElementById('confirmDeleteModal');
        const deleteModalTitle = document.getElementById('deleteModalTitle');
        const deleteModalMessage = document.getElementById('deleteModalMessage');
        const closeConfirmDeleteModal = document.getElementById('closeConfirmDeleteModal');
        const cancelDelete = document.getElementById('cancelDelete');
        const confirmDelete = document.getElementById('confirmDelete');
        const themeSwitcher = document.getElementById('themeSwitcher');
        const exportBtn = document.getElementById('exportBtn');
        const importBtn = document.getElementById('importBtn');
        const exportModal = document.getElementById('exportModal');
        const closeExportModal = document.getElementById('closeExportModal');
        const cancelExport = document.getElementById('cancelExport');
        const downloadExport = document.getElementById('downloadExport');
        const exportContent = document.getElementById('exportContent');
        const exportFormatButtons = document.querySelectorAll('.export-format-btn');
        const importModal = document.getElementById('importModal');
        const importFileInput = document.getElementById('importFileInput');
        const importFileWarning = document.getElementById('importFileWarning');
        const importPreview = document.getElementById('importPreview');
        const previewSetName = document.getElementById('previewSetName');
        const previewCardCount = document.getElementById('previewCardCount');
        const previewFirstWords = document.getElementById('previewFirstWords');
        const importNameSection = document.getElementById('importNameSection');
        const importSetName = document.getElementById('importSetName');
        const importNameWarning = document.getElementById('importNameWarning');
        const closeImportModal = document.getElementById('closeImportModal');
        const cancelImport = document.getElementById('cancelImport');
        const confirmImport = document.getElementById('confirmImport');
        const importFormatButtons = document.querySelectorAll('.import-format-btn');
        const totalCards = document.getElementById('totalCards');
        const learnedCards = document.getElementById('learnedCards');
        const difficultCards = document.getElementById('difficultCards');
        const successRate = document.getElementById('successRate');
        const learnedProgress = document.getElementById('learnedProgress');
        const dueCards = document.getElementById('dueCards');
        const masteredCards = document.getElementById('masteredCards');
        const difficultWordsSection = document.getElementById('difficultWordsSection');
        const difficultWordsList = document.getElementById('difficultWordsList');
        const addPredefinedSetBtn = document.getElementById('addPredefinedSetBtn');
        const srsRatingButtons = document.getElementById('srsRatingButtons');
        const srsRatingBtns = document.querySelectorAll('.srs-rating-btn');

        // –≠–ª–µ–º–µ–Ω—Ç—ã –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        const searchFilterContainer = document.getElementById('searchFilterContainer');
        const searchInput = document.getElementById('searchInput');
        const clearSearchBtn = document.getElementById('clearSearchBtn');
        const filterButtons = document.querySelectorAll('.filter-btn');
        const searchResultsInfo = document.getElementById('searchResultsInfo');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        function init() {
            applyTheme();
            renderSets();
            setupEventListeners();
            initPWA();
            
            // –ï—Å–ª–∏ –µ—Å—Ç—å –Ω–∞–±–æ—Ä—ã, –≤—ã–±–∏—Ä–∞–µ–º –ø–µ—Ä–≤—ã–π
            if (sets.length > 0) {
                selectSet(sets[0].id);
            } else {
                showEmptyState();
            }
        }

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function setupEventListeners() {
            createSetBtn.addEventListener('click', () => {
                createSetModal.classList.add('active');
                setNameInput.focus();
            });
            
            closeCreateSetModal.addEventListener('click', closeCreateSetModalFunc);
            cancelCreateSet.addEventListener('click', closeCreateSetModalFunc);
            
            saveSet.addEventListener('click', () => {
                const name = setNameInput.value.trim();
                if (name) {
                    setNameWarning.style.display = 'none';
                    createSet(name);
                    closeCreateSetModalFunc();
                } else {
                    setNameWarning.style.display = 'block';
                }
            });
            
            closeCreateCardModal.addEventListener('click', closeCreateCardModalFunc);
            cancelCreateCard.addEventListener('click', closeCreateCardModalFunc);
            
            saveCard.addEventListener('click', () => {
                const term = cardTermInput.value.trim();
                const definition = cardDefinitionInput.value.trim();
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ –Ω–∞–±–æ—Ä
                if (!currentSetId) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–±–æ—Ä', 'error');
                    closeCreateCardModalFunc();
                    return;
                }
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–ª–µ–π
                let hasError = false;
                
                if (!term) {
                    cardTermWarning.style.display = 'block';
                    hasError = true;
                } else {
                    cardTermWarning.style.display = 'none';
                }
                
                if (!definition) {
                    cardDefinitionWarning.style.display = 'block';
                    hasError = true;
                } else {
                    cardDefinitionWarning.style.display = 'none';
                }
                
                if (!hasError) {
                    if (editingCardId) {
                        updateCard(currentSetId, editingCardId, term, definition);
                    } else {
                        createCard(currentSetId, term, definition);
                    }
                    closeCreateCardModalFunc();
                }
            });
            
            // –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞–±–æ—Ä–∞
            closeEditSetModal.addEventListener('click', closeEditSetModalFunc);
            cancelEditSet.addEventListener('click', closeEditSetModalFunc);
            saveEditSet.addEventListener('click', () => {
                const name = editSetName.value.trim();
                if (name) {
                    editSetNameWarning.style.display = 'none';
                    updateSet(editingSetId, name);
                    closeEditSetModalFunc();
                } else {
                    editSetNameWarning.style.display = 'block';
                }
            });
            
            cardsModeBtn.addEventListener('click', () => switchMode('cards'));
            studyModeBtn.addEventListener('click', () => switchMode('study'));
            statsModeBtn.addEventListener('click', () => switchMode('stats'));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
            viewModeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    viewModeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentViewMode = btn.dataset.view;
                    renderCards();
                });
            });
            
            prevQuestionBtn.addEventListener('click', showPreviousQuestion);
            nextQuestionBtn.addEventListener('click', showNextQuestion);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è —Ç–∏–ø–æ–≤ –æ–±—É—á–µ–Ω–∏—è
            studyTypeButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    studyTypeButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentStudyType = btn.dataset.type;
                    if (currentSetId) {
                        startStudySession();
                    }
                });
            });
            
            checkTypingAnswer.addEventListener('click', checkTypingAnswerFunc);
            typingAnswer.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkTypingAnswerFunc();
                }
            });
            
            playAudioBtn.addEventListener('click', playAudioWord);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
            closeConfirmDeleteModal.addEventListener('click', closeConfirmDeleteModalFunc);
            cancelDelete.addEventListener('click', closeConfirmDeleteModalFunc);
            confirmDelete.addEventListener('click', confirmDeleteFunc);
            
            // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
            themeSwitcher.addEventListener('click', toggleTheme);
            
            // –≠–∫—Å–ø–æ—Ä—Ç/–∏–º–ø–æ—Ä—Ç
            exportBtn.addEventListener('click', showExportModal);
            importBtn.addEventListener('click', showImportModal);
            
            // –≠–∫—Å–ø–æ—Ä—Ç
            closeExportModal.addEventListener('click', closeExportModalFunc);
            cancelExport.addEventListener('click', closeExportModalFunc);
            downloadExport.addEventListener('click', downloadExportFile);
            
            // –ò–º–ø–æ—Ä—Ç
            importFileInput.addEventListener('change', handleFileImport);
            importSetName.addEventListener('input', validateImportName);
            closeImportModal.addEventListener('click', closeImportModalFunc);
            cancelImport.addEventListener('click', closeImportModalFunc);
            confirmImport.addEventListener('click', confirmImportFunc);
            
            // –ö–Ω–æ–ø–∫–∏ —Ñ–æ—Ä–º–∞—Ç–æ–≤
            exportFormatButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    exportFormatButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentExportFormat = btn.dataset.format;
                    updateExportContent();
                });
            });
            
            importFormatButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    importFormatButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentImportFormat = btn.dataset.format;
                    importFileInput.accept = currentImportFormat === 'json' ? '.json' : '.txt';
                    importFileInput.value = ''; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª
                    importPreview.style.display = 'none';
                    importNameSection.style.display = 'none';
                    confirmImport.disabled = true;
                });
            });
            
            // –ü–æ–∏—Å–∫ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è
            searchInput.addEventListener('input', handleSearch);
            clearSearchBtn.addEventListener('click', clearSearch);
            filterButtons.forEach(btn => {
                btn.addEventListener('click', () => {
                    filterButtons.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.filter;
                    renderCards();
                });
            });

            // –ì–æ—Ç–æ–≤—ã–µ –Ω–∞–±–æ—Ä—ã
            addPredefinedSetBtn.addEventListener('click', showPredefinedSetsModal);

            // SRS –∫–Ω–æ–ø–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
            srsRatingBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    handleSRSRating(this.dataset.rating);
                });
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
            window.addEventListener('click', (e) => {
                if (e.target === createSetModal) {
                    closeCreateSetModalFunc();
                }
                if (e.target === createCardModal) {
                    closeCreateCardModalFunc();
                }
                if (e.target === editSetModal) {
                    closeEditSetModalFunc();
                }
                if (e.target === confirmDeleteModal) {
                    closeConfirmDeleteModalFunc();
                }
                if (e.target === exportModal) {
                    closeExportModalFunc();
                }
                if (e.target === importModal) {
                    closeImportModalFunc();
                }
            });
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞–∂–∞—Ç–∏—è Enter –≤ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–Ω–∞—Ö
            setNameInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveSet.click();
                }
            });
            
            cardTermInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    cardDefinitionInput.focus();
                }
            });
            
            cardDefinitionInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    saveCard.click();
                }
            });
        }

        // PWA —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
        function initPWA() {
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(function(error) {
                        console.log('ServiceWorker registration failed');
                    });
            }

            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ PWA
            let deferredPrompt;
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                showInstallPrompt();
            });

            function showInstallPrompt() {
                if (deferredPrompt && !document.getElementById('installPWAButton')) {
                    const installBtn = document.createElement('button');
                    installBtn.id = 'installPWAButton';
                    installBtn.textContent = 'üì± –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å';
                    installBtn.className = 'btn btn-success';
                    installBtn.style.marginLeft = '10px';
                    installBtn.onclick = installPWA;
                    
                    const headerActions = document.querySelector('.header-actions');
                    headerActions.appendChild(installBtn);
                }
            }

            function installPWA() {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showNotification('–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!', 'success');
                            document.getElementById('installPWAButton').remove();
                        }
                        deferredPrompt = null;
                    });
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–µ–º–∞–º–∏
        function applyTheme() {
            if (isDarkTheme) {
                document.body.setAttribute('data-theme', 'dark');
                themeSwitcher.textContent = '‚òÄÔ∏è';
            } else {
                document.body.removeAttribute('data-theme');
                themeSwitcher.textContent = 'üåô';
            }
        }

        function toggleTheme() {
            isDarkTheme = !isDarkTheme;
            localStorage.setItem('thinkSmileDarkTheme', isDarkTheme);
            applyTheme();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –Ω–∞–±–æ—Ä–∞–º–∏
        function createSet(name) {
            const newSet = {
                id: Date.now().toString(),
                name: name,
                cards: [],
                stats: {
                    totalStudied: 0,
                    correctAnswers: 0,
                    difficultWords: []
                }
            };
            
            sets.push(newSet);
            saveData();
            renderSets();
            selectSet(newSet.id);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏
            showNotification(`–ù–∞–±–æ—Ä "${name}" —É—Å–ø–µ—à–Ω–æ —Å–æ–∑–¥–∞–Ω!`, 'success');
        }

        function updateSet(setId, name) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                set.name = name;
                saveData();
                renderSets();
                if (currentSetId === setId) {
                    currentSetName.textContent = name;
                }
                showNotification(`–ù–∞–±–æ—Ä –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω –≤ "${name}"!`, 'success');
            }
        }

        function deleteSet(setId) {
            sets = sets.filter(set => set.id !== setId);
            saveData();
            renderSets();
            
            if (sets.length > 0) {
                selectSet(sets[0].id);
            } else {
                currentSetId = null;
                currentSetName.textContent = '–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä';
                showEmptyState();
            }
            
            showNotification('–ù–∞–±–æ—Ä —É–¥–∞–ª–µ–Ω', 'info');
            closeConfirmDeleteModalFunc(); // –ó–∞–∫—Ä—ã–≤–∞–µ–º –ø–æ–ø–∞–ø –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è
        }

        function selectSet(setId) {
            currentSetId = setId;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ —Å–ø–∏—Å–∫–µ
            document.querySelectorAll('.set-item').forEach(item => {
                item.classList.remove('active');
                if (item.dataset.id === setId) {
                    item.classList.add('active');
                }
            });
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–µ –∏–º—è –Ω–∞–±–æ—Ä–∞
            const set = sets.find(s => s.id === setId);
            if (set) {
                currentSetName.textContent = set.name;
                renderCards();
                updateStudyQuestions();
                updateStats();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                if (set.cards.length > 0) {
                    viewModeSelector.style.display = 'flex';
                } else {
                    viewModeSelector.style.display = 'none';
                }
                
                if (set.cards.length === 0) {
                    showEmptyState();
                } else {
                    hideEmptyState();
                }
            }
        }

        function renderSets() {
            setsList.innerHTML = '';
            
            if (sets.length === 0) {
                setsList.innerHTML = '<p style="color: var(--gray); text-align: center; padding: 20px;">–ù–µ—Ç –Ω–∞–±–æ—Ä–æ–≤</p>';
                return;
            }
            
            sets.forEach(set => {
                const setItem = document.createElement('div');
                setItem.className = 'set-item';
                setItem.dataset.id = set.id;
                setItem.innerHTML = `
                    <div class="set-icon">${set.name.charAt(0).toUpperCase()}</div>
                    <span>${set.name}</span>
                    <span style="margin-left: auto; font-size: 12px; color: var(--gray); margin-right: 10px;">${set.cards.length}</span>
                    <div class="set-actions">
                        <button class="action-btn edit-set-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä">‚úèÔ∏è</button>
                        <button class="action-btn delete-btn" title="–£–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä">üóëÔ∏è</button>
                    </div>
                `;
                
                setItem.addEventListener('click', (e) => {
                    if (!e.target.closest('.set-actions')) {
                        selectSet(set.id);
                    }
                });
                
                const editBtn = setItem.querySelector('.edit-set-btn');
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showEditSetModal(set.id, set.name);
                });
                
                const deleteBtn = setItem.querySelector('.delete-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    showDeleteSetModal(set.id, set.name);
                });
                
                setsList.appendChild(setItem);
            });
        }

        function showEditSetModal(setId, setName) {
            editingSetId = setId;
            editSetName.value = setName;
            editSetNameWarning.style.display = 'none';
            editSetModal.classList.add('active');
            editSetName.focus();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏
        function createCard(setId, term, definition) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                set.cards.push({
                    id: Date.now().toString(),
                    term: term,
                    definition: definition,
                    transcription: getTranscription(term),
                    stats: {
                        studied: 0,
                        correct: 0,
                        difficulty: 0 // 0-–ª–µ–≥–∫–æ–µ, 1-—Å—Ä–µ–¥–Ω–µ–µ, 2-—Å–ª–æ–∂–Ω–æ–µ
                    },
                    userDifficulty: 'easy', // easy, medium, hard
                    srs: {
                        stage: 0,
                        interval: 1,
                        dueDate: new Date(),
                        easeFactor: 2.5,
                        reviews: 0
                    }
                });
                
                saveData();
                renderCards();
                updateStudyQuestions();
                updateStats();
                hideEmptyState();
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏
                showNotification(`–ö–∞—Ä—Ç–æ—á–∫–∞ "${term}" –¥–æ–±–∞–≤–ª–µ–Ω–∞!`, 'success');
            }
        }

        function updateCard(setId, cardId, term, definition) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                const card = set.cards.find(c => c.id === cardId);
                if (card) {
                    card.term = term;
                    card.definition = definition;
                    card.transcription = getTranscription(term);
                    
                    saveData();
                    renderCards();
                    updateStudyQuestions();
                    updateStats();
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—à–Ω–æ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏
                    showNotification(`–ö–∞—Ä—Ç–æ—á–∫–∞ "${term}" –æ–±–Ω–æ–≤–ª–µ–Ω–∞!`, 'success');
                }
            }
        }

        function updateCardDifficulty(setId, cardId, difficulty) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                const card = set.cards.find(c => c.id === cardId);
                if (card) {
                    card.userDifficulty = difficulty;
                    saveData();
                    renderCards();
                    showNotification(`–°–ª–æ–∂–Ω–æ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏ "${card.term}" –∏–∑–º–µ–Ω–µ–Ω–∞ –Ω–∞ "${getDifficultyLabel(difficulty)}"`, 'info');
                }
            }
        }

        function getDifficultyLabel(difficulty) {
            const labels = {
                'easy': '–õ–µ–≥–∫–æ–µ',
                'medium': '–°—Ä–µ–¥–Ω–µ–µ', 
                'hard': '–°–ª–æ–∂–Ω–æ–µ'
            };
            return labels[difficulty] || '–õ–µ–≥–∫–æ–µ';
        }

        function deleteCard(setId, cardId) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                const cardIndex = set.cards.findIndex(c => c.id === cardId);
                if (cardIndex !== -1) {
                    const cardTerm = set.cards[cardIndex].term;
                    set.cards.splice(cardIndex, 1);
                    
                    saveData();
                    renderCards();
                    updateStudyQuestions();
                    updateStats();
                    
                    if (set.cards.length === 0) {
                        showEmptyState();
                    }
                    
                    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É–¥–∞–ª–µ–Ω–∏–∏
                    showNotification(`–ö–∞—Ä—Ç–æ—á–∫–∞ "${cardTerm}" —É–¥–∞–ª–µ–Ω–∞`, 'info');
                }
            }
        }

        function updateCardStats(setId, cardId, isCorrect) {
            const set = sets.find(s => s.id === setId);
            if (set) {
                const card = set.cards.find(c => c.id === cardId);
                if (card) {
                    card.stats.studied++;
                    if (isCorrect) {
                        card.stats.correct++;
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å–ª–æ–≤–∞
                    const successRate = card.stats.correct / card.stats.studied;
                    if (successRate < 0.5) {
                        card.stats.difficulty = 2; // –°–ª–æ–∂–Ω–æ–µ
                    } else if (successRate < 0.8) {
                        card.stats.difficulty = 1; // –°—Ä–µ–¥–Ω–µ–µ
                    } else {
                        card.stats.difficulty = 0; // –õ–µ–≥–∫–æ–µ
                    }
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –Ω–∞–±–æ—Ä–∞
                    set.stats.totalStudied++;
                    if (isCorrect) {
                        set.stats.correctAnswers++;
                    }
                    
                    saveData();
                    updateStats();
                }
            }
        }

        // SRS —Ñ—É–Ω–∫—Ü–∏–∏
        function updateCardSRS(cardId, rating) {
            const set = sets.find(s => s.id === currentSetId);
            if (!set) return;
            
            const card = set.cards.find(c => c.id === cardId);
            if (!card) return;
            
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º SRS –¥–∞–Ω–Ω—ã–µ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
            if (!card.srs) {
                card.srs = {
                    stage: 0,
                    interval: 1, // –≤ –¥–Ω—è—Ö
                    dueDate: new Date(),
                    easeFactor: 2.5,
                    reviews: 0
                };
            }
            
            const srs = card.srs;
            srs.reviews++;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç–≤–µ—Ç–∞
            if (rating === 'again') {
                srs.stage = Math.max(0, srs.stage - 1);
                srs.easeFactor = Math.max(1.3, srs.easeFactor - 0.2);
            } else if (rating === 'hard') {
                srs.easeFactor = Math.max(1.3, srs.easeFactor - 0.15);
            } else if (rating === 'good') {
                srs.stage = Math.min(4, srs.stage + 1);
            } else if (rating === 'easy') {
                srs.stage = Math.min(4, srs.stage + 2);
                srs.easeFactor = Math.min(2.5, srs.easeFactor + 0.1);
            }
            
            // –í—ã—á–∏—Å–ª—è–µ–º –Ω–æ–≤—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª
            if (srs.stage === 0) {
                srs.interval = 1;
            } else if (srs.stage === 1) {
                srs.interval = 1;
            } else {
                srs.interval = Math.round(srs.interval * srs.easeFactor);
            }
            
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–∞—Ç—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
            const nextDate = new Date();
            nextDate.setDate(nextDate.getDate() + srs.interval);
            srs.dueDate = nextDate;
            
            saveData();
        }

        function getDueCards() {
            if (!currentSetId) return [];
            
            const set = sets.find(s => s.id === currentSetId);
            if (!set) return [];
            
            const now = new Date();
            return set.cards.filter(card => {
                if (!card.srs) return true; // –ù–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
                return new Date(card.srs.dueDate) <= now;
            });
        }

        function getStudyPriority() {
            const dueCards = getDueCards();
            return dueCards.sort((a, b) => {
                const aDue = a.srs ? new Date(a.srs.dueDate) : new Date(0);
                const bDue = b.srs ? new Date(b.srs.dueDate) : new Date(0);
                return aDue - bDue;
            });
        }

        function handleSRSRating(rating) {
            const currentQuestion = studyQuestions[currentQuestionIndex];
            if (currentQuestion && currentQuestion.cardId) {
                updateCardSRS(currentQuestion.cardId, rating);
                showNotification(`–†–µ–π—Ç–∏–Ω–≥ "${getRatingLabel(rating)}" —Å–æ—Ö—Ä–∞–Ω–µ–Ω`, 'info');
                
                // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É
                if (currentQuestionIndex < studyQuestions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                } else {
                    switchMode('cards');
                    showNotification('–°–µ—Å—Å–∏—è –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω–æ–≥–æ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéä', 'success');
                }
            }
        }

        function getRatingLabel(rating) {
            const labels = {
                'again': '–°–Ω–æ–≤–∞',
                'hard': '–¢—Ä—É–¥–Ω–æ',
                'good': '–•–æ—Ä–æ—à–æ',
                'easy': '–õ–µ–≥–∫–æ'
            };
            return labels[rating] || rating;
        }

        function renderCards() {
            cardsContainer.innerHTML = '';
            cardsList.innerHTML = '';
            
            if (!currentSetId) {
                cardsContainer.innerHTML = '<div class="empty-state"><i>üìö</i><h3>–í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä</h3><p>–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏</p></div>';
                return;
            }
            
            const set = sets.find(s => s.id === currentSetId);
            if (!set) return;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –ø–æ–∏—Å–∫ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–ª–∏—á–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
            if (set.cards.length > 0) {
                searchFilterContainer.style.display = 'block';
            } else {
                searchFilterContainer.style.display = 'none';
            }
            
            let filteredCards = set.cards;
            let visibleCount = 0;
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º –ø–æ–∏—Å–∫
            if (currentSearchQuery) {
                const query = currentSearchQuery.toLowerCase();
                filteredCards = filteredCards.filter(card => 
                    card.term.toLowerCase().includes(query) || 
                    card.definition.toLowerCase().includes(query)
                );
            }
            
            // –ü—Ä–∏–º–µ–Ω—è–µ–º —Ñ–∏–ª—å—Ç—Ä –ø–æ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
            if (currentFilter !== 'all') {
                filteredCards = filteredCards.filter(card => card.userDifficulty === currentFilter);
            }
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ
            if (currentViewMode === 'cards') {
                cardsContainer.style.display = 'grid';
                cardsList.style.display = 'none';
                renderCardsView(filteredCards);
            } else {
                cardsContainer.style.display = 'none';
                cardsList.style.display = 'flex';
                renderListView(filteredCards);
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø–æ–∏—Å–∫–∞
            searchResultsInfo.textContent = `–ù–∞–π–¥–µ–Ω–æ –∫–∞—Ä—Ç–æ—á–µ–∫: ${filteredCards.length} –∏–∑ ${set.cards.length}`;
            
            // –ï—Å–ª–∏ –ø–æ—Å–ª–µ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –Ω–µ—Ç –∫–∞—Ä—Ç–æ—á–µ–∫, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
            if (filteredCards.length === 0) {
                const noResultsElement = document.createElement('div');
                noResultsElement.className = 'empty-state';
                noResultsElement.innerHTML = `
                    <i>üîç</i>
                    <h3>–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</h3>
                    <p>–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å –∏–ª–∏ —Ñ–∏–ª—å—Ç—Ä</p>
                `;
                if (currentViewMode === 'cards') {
                    cardsContainer.appendChild(noResultsElement);
                } else {
                    cardsList.appendChild(noResultsElement);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –Ω–æ–≤–æ–π –∫–∞—Ä—Ç–æ—á–∫–∏
            const addCardBtn = document.createElement('div');
            addCardBtn.className = 'add-card-btn';
            addCardBtn.innerHTML = `
                <i>+</i>
                <span>–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É</span>
            `;
            addCardBtn.addEventListener('click', () => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –≤—ã–±—Ä–∞–Ω –ª–∏ –Ω–∞–±–æ—Ä
                if (!currentSetId) {
                    showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –Ω–∞–±–æ—Ä', 'error');
                    return;
                }
                
                cardTermInput.value = '';
                cardDefinitionInput.value = '';
                cardTermWarning.style.display = 'none';
                cardDefinitionWarning.style.display = 'none';
                cardModalTitle.textContent = '–î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
                editingCardId = null;
                createCardModal.classList.add('active');
                cardTermInput.focus();
            });
            
            if (currentViewMode === 'cards') {
                cardsContainer.appendChild(addCardBtn);
            } else {
                cardsList.appendChild(addCardBtn);
            }
            
            visibleCount = filteredCards.length;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–µ–∫
        function renderCardsView(cards) {
            cards.forEach(card => {
                const difficultyLabels = ['', 'üü° –°—Ä–µ–¥–Ω–µ–µ', 'üî¥ –°–ª–æ–∂–Ω–æ–µ'];
                const srsStageLabels = ['üÜï', 'üìö', 'üîÑ', '‚úÖ', 'üéØ'];
                
                const cardElement = document.createElement('div');
                cardElement.className = `card ${card.userDifficulty}`;
                cardElement.innerHTML = `
                    <div class="card-header">
                        <div class="card-header-left">
                            ${card.stats.difficulty > 0 ? `<div class="card-difficulty">${difficultyLabels[card.stats.difficulty]}</div>` : ''}
                            ${card.srs && card.srs.stage > 0 ? `<div class="srs-stage">${srsStageLabels[card.srs.stage]} ${SRSStages[card.srs.stage].name}</div>` : ''}
                        </div>
                        <div class="card-actions">
                            <button class="action-btn edit-card-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                            <button class="action-btn delete-card-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="card-term">
                        ${card.term}
                        <button class="card-audio-btn" title="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ">üîä</button>
                    </div>
                    ${card.transcription ? `<div class="transcription">${card.transcription}</div>` : ''}
                    <div class="card-definition">${card.definition}</div>
                    <div class="difficulty-selector">
                        <button class="difficulty-btn easy ${card.userDifficulty === 'easy' ? 'active' : ''}" data-difficulty="easy">–õ–µ–≥–∫–æ–µ</button>
                        <button class="difficulty-btn medium ${card.userDifficulty === 'medium' ? 'active' : ''}" data-difficulty="medium">–°—Ä–µ–¥–Ω–µ–µ</button>
                        <button class="difficulty-btn hard ${card.userDifficulty === 'hard' ? 'active' : ''}" data-difficulty="hard">–°–ª–æ–∂–Ω–æ–µ</button>
                    </div>
                    ${card.stats.studied > 0 ? `
                        <div style="margin-top: 10px; font-size: 12px; color: var(--gray);">
                            –ò–∑—É—á–µ–Ω–æ: ${card.stats.studied} —Ä–∞–∑, –£—Å–ø–µ—à–Ω–æ: ${Math.round((card.stats.correct / card.stats.studied) * 100)}%
                        </div>
                    ` : ''}
                    ${card.srs ? `
                        <div style="margin-top: 5px; font-size: 11px; color: var(--gray);">
                            SRS: ${card.srs.reviews} –ø–æ–≤—Ç., —Å–ª–µ–¥. –ø–æ–≤—Ç–æ—Ä: ${new Date(card.srs.dueDate).toLocaleDateString()}
                        </div>
                    ` : ''}
                `;
                
                const editBtn = cardElement.querySelector('.edit-card-btn');
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    editCard(card.id);
                });
                
                const deleteBtn = cardElement.querySelector('.delete-card-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteCard(currentSetId, card.id);
                });
                
                const audioBtn = cardElement.querySelector('.card-audio-btn');
                audioBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    playWordAudio(card.term);
                });
                
                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
                const difficultyBtns = cardElement.querySelectorAll('.difficulty-btn');
                difficultyBtns.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        e.stopPropagation();
                        updateCardDifficulty(currentSetId, card.id, btn.dataset.difficulty);
                    });
                });
                
                cardsContainer.appendChild(cardElement);
            });
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞
        function renderListView(cards) {
            cards.forEach(card => {
                const listItem = document.createElement('div');
                listItem.className = `list-item ${card.userDifficulty}`;
                listItem.innerHTML = `
                    <div class="list-item-content">
                        <div class="list-term">${card.term}</div>
                        ${card.transcription ? `<div class="list-transcription">${card.transcription}</div>` : '<div class="list-transcription"></div>'}
                        <div class="list-definition">${card.definition}</div>
                    </div>
                    <div class="list-actions">
                        <button class="audio-btn-small" title="–ü—Ä–æ—Å–ª—É—à–∞—Ç—å –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ">üîä</button>
                        <button class="action-btn edit-card-btn" title="–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å">‚úèÔ∏è</button>
                        <button class="action-btn delete-card-btn" title="–£–¥–∞–ª–∏—Ç—å">üóëÔ∏è</button>
                    </div>
                `;
                
                const editBtn = listItem.querySelector('.edit-card-btn');
                editBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    editCard(card.id);
                });
                
                const deleteBtn = listItem.querySelector('.delete-card-btn');
                deleteBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    deleteCard(currentSetId, card.id);
                });
                
                const audioBtn = listItem.querySelector('.audio-btn-small');
                audioBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    playWordAudio(card.term);
                });
                
                cardsList.appendChild(listItem);
            });
        }

        // –§—É–Ω–∫—Ü–∏–∏ –ø–æ–∏—Å–∫–∞ –∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        function handleSearch() {
            currentSearchQuery = searchInput.value.trim();
            renderCards();
        }

        function clearSearch() {
            searchInput.value = '';
            currentSearchQuery = '';
            renderCards();
        }

        function editCard(cardId) {
            const set = sets.find(s => s.id === currentSetId);
            if (set) {
                const card = set.cards.find(c => c.id === cardId);
                if (card) {
                    cardTermInput.value = card.term;
                    cardDefinitionInput.value = card.definition;
                    cardTermWarning.style.display = 'none';
                    cardDefinitionWarning.style.display = 'none';
                    cardModalTitle.textContent = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫—É';
                    editingCardId = cardId;
                    createCardModal.classList.add('active');
                    cardTermInput.focus();
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏
        function getTranscription(word) {
            // –ü—Ä–æ—Å—Ç–∞—è –∏–º–∏—Ç–∞—Ü–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏–∏ - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å API
            const transcriptionMap = {
                'apple': '[Àà√¶p.…ôl]',
                'banana': '[b…ôÀàn…ëÀê.n…ô]',
                'orange': '[Àà…ír.…™nd í]',
                'hello': '[h…ôÀàl…ô ä]',
                'goodbye': '[…° ädÀàba…™]',
                'thank you': '[ÀàŒ∏√¶≈ãk juÀê]',
                'please': '[pliÀêz]',
                'sorry': '[Ààs…ír.i]',
                'water': '[Ààw…îÀê.t…ôr]',
                'food': '[fuÀêd]',
                'house': '[ha äs]',
                'car': '[k…ëÀêr]',
                'book': '[b äk]',
                'pen': '[pen]',
                'computer': '[k…ômÀàpjuÀê.t…ôr]',
                'phone': '[f…ô än]',
                'friend': '[frend]',
                'family': '[Ààf√¶m.…ôl.i]',
                'school': '[skuÀêl]',
                'work': '[w…úÀêk]',
                'time': '[ta…™m]',
                'day': '[de…™]',
                'night': '[na…™t]',
                'week': '[wiÀêk]',
                'month': '[m ånŒ∏]',
                'year': '[j…™…ôr]',
                'people': '[ÀàpiÀê.p…ôl]',
                'man': '[m√¶n]',
                'woman': '[Ààw äm.…ôn]',
                'child': '[t Éa…™ld]',
                'city': '[Ààs…™t.i]',
                'country': '[Ààk ån.tri]',
                'world': '[w…úÀêld]',
                'life': '[la…™f]',
                'love': '[l åv]',
                'happy': '[Ààh√¶p.i]',
                'sad': '[s√¶d]',
                'good': '[…° äd]',
                'bad': '[b√¶d]',
                'big': '[b…™…°]',
                'small': '[sm…îÀêl]',
                'hot': '[h…ít]',
                'cold': '[k…ô äld]',
                'new': '[njuÀê]',
                'old': '[…ô äld]',
                'young': '[j å≈ã]',
                'beautiful': '[ÀàbjuÀê.t…™.f…ôl]',
                'ugly': '[Àà å…°.li]',
                'rich': '[r…™t É]',
                'poor': '[p…îÀêr]',
                'fast': '[f…ëÀêst]',
                'slow': '[sl…ô ä]',
                'easy': '[ÀàiÀê.zi]',
                'difficult': '[Ààd…™f.…™.k…ôlt]',
                'important': '[…™mÀàp…îÀê.t…ônt]',
                'interesting': '[Àà…™n.tr…ôs.t…™≈ã]',
                'boring': '[Ààb…îÀê.r…™≈ã]',
                'funny': '[Ààf ån.i]',
                'serious': '[Ààs…™…ô.ri.…ôs]'
            };
            
            return transcriptionMap[word.toLowerCase()] || '';
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è –∞—É–¥–∏–æ —Å–ª–æ–≤–∞
        function playWordAudio(word) {
            if (word && speechSynthesis) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(word);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                utterance.pitch = 1;
                utterance.volume = 1;
                
                // –ü—ã—Ç–∞–µ–º—Å—è –Ω–∞–π—Ç–∏ –±—Ä–∏—Ç–∞–Ω—Å–∫–∏–π –∞–∫—Ü–µ–Ω—Ç
                const voices = speechSynthesis.getVoices();
                const englishVoice = voices.find(voice => 
                    voice.lang.includes('en') && voice.name.includes('British')
                ) || voices.find(voice => 
                    voice.lang.includes('en')
                );
                
                if (englishVoice) {
                    utterance.voice = englishVoice;
                }
                
                speechSynthesis.speak(utterance);
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Ä–µ–∂–∏–º–∞ –∑–∞—É—á–∏–≤–∞–Ω–∏—è
        function switchMode(mode) {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è
            if ((mode === 'study' || mode === 'stats') && currentSetId) {
                const set = sets.find(s => s.id === currentSetId);
                if (!set || set.cards.length === 0) {
                    showNotification('–î–æ–±–∞–≤—å—Ç–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ –Ω–∞–±–æ—Ä –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —ç—Ç–æ–≥–æ —Ä–µ–∂–∏–º–∞', 'error');
                    return;
                }
            }
            
            currentMode = mode;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
            cardsContainer.style.display = 'none';
            cardsList.style.display = 'none';
            studyContainer.classList.remove('active');
            statsContainer.style.display = 'none';
            searchFilterContainer.style.display = 'none';
            viewModeSelector.style.display = 'none';
            srsRatingButtons.style.display = 'none';
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
            cardsModeBtn.classList.remove('active');
            studyModeBtn.classList.remove('active');
            statsModeBtn.classList.remove('active');
            
            if (mode === 'cards') {
                cardsModeBtn.classList.add('active');
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ä–µ–∂–∏–º–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏
                const set = sets.find(s => s.id === currentSetId);
                if (set && set.cards.length > 0) {
                    viewModeSelector.style.display = 'flex';
                    searchFilterContainer.style.display = 'block';
                }
                renderCards();
            } else if (mode === 'study') {
                studyModeBtn.classList.add('active');
                studyContainer.classList.add('active');
                
                if (currentSetId) {
                    startStudySession();
                }
            } else if (mode === 'stats') {
                statsModeBtn.classList.add('active');
                statsContainer.style.display = 'block';
                updateStats();
            }
        }

        function updateStudyQuestions() {
            if (!currentSetId) return;
            
            const set = sets.find(s => s.id === currentSetId);
            if (!set) return;
            
            studyQuestions = [];
            
            // –°–æ–∑–¥–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–±—É—á–µ–Ω–∏—è
            if (currentStudyType === 'mixed') {
                // –°–º–µ—à–∞–Ω–Ω—ã–π —Ä–µ–∂–∏–º - –≤—Å–µ —Ç–∏–ø—ã –≤–æ–ø—Ä–æ—Å–æ–≤
                set.cards.forEach(card => {
                    // –ê–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí —Ä—É—Å—Å–∫–∏–π
                    studyQuestions.push({
                        type: 'en-ru',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.term}"?`,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                    
                    // –†—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
                    studyQuestions.push({
                        type: 'ru-en',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.definition}"?`,
                        correctAnswer: card.term,
                        options: generateOptions(card.term, set.cards, 'term'),
                        cardId: card.id
                    });
                    
                    // –ü–µ—á–∞—Ç—å (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí —Ä—É—Å—Å–∫–∏–π)
                    studyQuestions.push({
                        type: 'typing-en-ru',
                        question: `–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞ "${card.term}"`,
                        correctAnswer: card.definition.toLowerCase(),
                        cardId: card.id
                    });
                    
                    // –ü–µ—á–∞—Ç—å (—Ä—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π)
                    studyQuestions.push({
                        type: 'typing-ru-en',
                        question: `–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞ "${card.definition}"`,
                        correctAnswer: card.term.toLowerCase(),
                        cardId: card.id
                    });
                    
                    // –ê—É–¥–∏–æ
                    studyQuestions.push({
                        type: 'audio',
                        question: `–ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ —Å–ª–æ–≤–æ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥`,
                        audioWord: card.term,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'en-ru') {
                // –¢–æ–ª—å–∫–æ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π ‚Üí —Ä—É—Å—Å–∫–∏–π
                set.cards.forEach(card => {
                    studyQuestions.push({
                        type: 'en-ru',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.term}"?`,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'ru-en') {
                // –¢–æ–ª—å–∫–æ —Ä—É—Å—Å–∫–∏–π ‚Üí –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
                set.cards.forEach(card => {
                    studyQuestions.push({
                        type: 'ru-en',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.definition}"?`,
                        correctAnswer: card.term,
                        options: generateOptions(card.term, set.cards, 'term'),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'typing') {
                // –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
                set.cards.forEach(card => {
                    studyQuestions.push({
                        type: 'typing-en-ru',
                        question: `–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞ "${card.term}"`,
                        correctAnswer: card.definition.toLowerCase(),
                        cardId: card.id
                    });
                    
                    studyQuestions.push({
                        type: 'typing-ru-en',
                        question: `–ù–∞–ø–∏—à–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥ —Å–ª–æ–≤–∞ "${card.definition}"`,
                        correctAnswer: card.term.toLowerCase(),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'audio') {
                // –ê—É–¥–∏–æ —Ä–µ–∂–∏–º
                set.cards.forEach(card => {
                    studyQuestions.push({
                        type: 'audio',
                        question: `–ü—Ä–æ—Å–ª—É—à–∞–π—Ç–µ —Å–ª–æ–≤–æ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø–µ—Ä–µ–≤–æ–¥`,
                        audioWord: card.term,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'difficult') {
                // –°–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞
                const difficultCards = set.cards.filter(card => card.userDifficulty === 'hard' || card.stats.difficulty === 2);
                if (difficultCards.length === 0) {
                    showNotification('–ù–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö —Å–ª–æ–≤ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è!', 'info');
                    return;
                }
                
                difficultCards.forEach(card => {
                    studyQuestions.push({
                        type: 'en-ru',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.term}"?`,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                });
            } else if (currentStudyType === 'srs') {
                // –†–µ–∂–∏–º –∏–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã—Ö –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–π
                const dueCards = getStudyPriority();
                if (dueCards.length === 0) {
                    showNotification('–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º! –í—Å–µ —Å–ª–æ–≤–∞ –∏–∑—É—á–µ–Ω—ã –Ω–∞ —Å–µ–≥–æ–¥–Ω—è üéâ', 'success');
                    return;
                }
                
                // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 20 –∫–∞—Ä—Ç–æ—á–µ–∫ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è
                const cardsToStudy = dueCards.slice(0, 20);
                
                cardsToStudy.forEach(card => {
                    studyQuestions.push({
                        type: 'srs-en-ru',
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.term}"?`,
                        correctAnswer: card.definition,
                        options: generateOptions(card.definition, set.cards, 'definition'),
                        cardId: card.id
                    });
                    
                    studyQuestions.push({
                        type: 'srs-ru-en', 
                        question: `–ö–∞–∫ –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—Å—è —Å–ª–æ–≤–æ "${card.definition}"?`,
                        correctAnswer: card.term,
                        options: generateOptions(card.term, set.cards, 'term'),
                        cardId: card.id
                    });
                });
            }
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
            studyQuestions = shuffleArray(studyQuestions);
        }

        function generateOptions(correctAnswer, cards, type) {
            const options = [correctAnswer];
            
            // –ë–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è/—Ç–µ—Ä–º–∏–Ω—ã –∏–∑ –¥—Ä—É–≥–∏—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
            while (options.length < 4 && options.length < cards.length) {
                const randomCard = cards[Math.floor(Math.random() * cards.length)];
                const randomOption = type === 'definition' ? randomCard.definition : randomCard.term;
                
                if (!options.includes(randomOption)) {
                    options.push(randomOption);
                }
            }
            
            // –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–ø—Ü–∏–π, –¥–æ–±–∞–≤–ª—è–µ–º –ø—É—Å—Ç—ã–µ
            while (options.length < 4) {
                options.push(`–í–∞—Ä–∏–∞–Ω—Ç ${options.length + 1}`);
            }
            
            return shuffleArray(options);
        }

        function startStudySession() {
            updateStudyQuestions();
            if (studyQuestions.length === 0) {
                showNotification('–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º —Ä–µ–∂–∏–º–µ', 'error');
                return;
            }
            currentQuestionIndex = 0;
            showQuestion();
        }

        function showQuestion() {
            if (studyQuestions.length === 0) {
                studyQuestion.textContent = "–ù–µ—Ç –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è –∏–∑—É—á–µ–Ω–∏—è";
                studyOptions.innerHTML = '';
                return;
            }
            
            const question = studyQuestions[currentQuestionIndex];
            studyQuestion.textContent = question.question;
            studyProgress.textContent = `–í–æ–ø—Ä–æ—Å ${currentQuestionIndex + 1} –∏–∑ ${studyQuestions.length}`;
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
            prevQuestionBtn.disabled = currentQuestionIndex === 0;
            nextQuestionBtn.textContent = currentQuestionIndex === studyQuestions.length - 1 ? '–ó–∞–≤–µ—Ä—à–∏—Ç—å' : '–î–∞–ª–µ–µ';
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞
            studyOptions.style.display = 'none';
            typingInputContainer.style.display = 'none';
            audioContainer.style.display = 'none';
            srsRatingButtons.style.display = 'none';
            
            if (question.type.includes('typing')) {
                typingInputContainer.style.display = 'block';
                typingAnswer.value = '';
                typingAnswer.focus();
                typingAnswer.style.borderColor = 'var(--border-color)';
            } else if (question.type === 'audio') {
                audioContainer.style.display = 'block';
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–æ–∏–≥—Ä—ã–≤–∞–µ–º —Å–ª–æ–≤–æ –ø—Ä–∏ –ø–æ–∫–∞–∑–µ –≤–æ–ø—Ä–æ—Å–∞
                setTimeout(() => playAudioWord(), 500);
                // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –¥–ª—è –∞—É–¥–∏–æ —Ä–µ–∂–∏–º–∞
                audioOptions.innerHTML = '';
                question.options.forEach(option => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'option';
                    optionBtn.textContent = option;
                    optionBtn.addEventListener('click', () => checkAnswer(optionBtn, option, question.correctAnswer, question.cardId));
                    audioOptions.appendChild(optionBtn);
                });
            } else if (question.type.includes('srs')) {
                // SRS —Ä–µ–∂–∏–º - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –∏ –∫–Ω–æ–ø–∫–∏ —Ä–µ–π—Ç–∏–Ω–≥–∞
                studyOptions.style.display = 'grid';
                srsRatingButtons.style.display = 'flex';
                // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                studyOptions.innerHTML = '';
                question.options.forEach(option => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'option';
                    optionBtn.textContent = option;
                    optionBtn.addEventListener('click', () => checkAnswer(optionBtn, option, question.correctAnswer, question.cardId));
                    studyOptions.appendChild(optionBtn);
                });
            } else {
                studyOptions.style.display = 'grid';
                // –°–æ–∑–¥–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤
                studyOptions.innerHTML = '';
                question.options.forEach(option => {
                    const optionBtn = document.createElement('button');
                    optionBtn.className = 'option';
                    optionBtn.textContent = option;
                    optionBtn.addEventListener('click', () => checkAnswer(optionBtn, option, question.correctAnswer, question.cardId));
                    studyOptions.appendChild(optionBtn);
                });
            }
        }

        function checkAnswer(optionBtn, selectedAnswer, correctAnswer, cardId) {
            // –û—Ç–∫–ª—é—á–∞–µ–º –≤—Å–µ –∫–Ω–æ–ø–∫–∏
            document.querySelectorAll('.option').forEach(btn => {
                btn.disabled = true;
            });
            
            const isCorrect = selectedAnswer === correctAnswer;
            
            if (isCorrect) {
                optionBtn.classList.add('correct');
                showNotification('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ', 'success');
            } else {
                optionBtn.classList.add('incorrect');
                
                // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
                document.querySelectorAll('.option').forEach(btn => {
                    if (btn.textContent === correctAnswer) {
                        btn.classList.add('correct');
                    }
                });
                
                showNotification(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${correctAnswer}`, 'error');
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏
            if (cardId) {
                updateCardStats(currentSetId, cardId, isCorrect);
            }
        }

        function checkTypingAnswerFunc() {
            const userAnswer = typingAnswer.value.trim().toLowerCase();
            const correctAnswer = studyQuestions[currentQuestionIndex].correctAnswer.toLowerCase();
            const isCorrect = userAnswer === correctAnswer;
            
            if (isCorrect) {
                showNotification('–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üéâ', 'success');
                typingAnswer.style.borderColor = 'var(--success)';
            } else {
                showNotification(`–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ. –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: ${studyQuestions[currentQuestionIndex].correctAnswer}`, 'error');
                typingAnswer.style.borderColor = 'var(--danger)';
            }
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–∞—Ä—Ç–æ—á–∫–∏
            if (studyQuestions[currentQuestionIndex].cardId) {
                updateCardStats(currentSetId, studyQuestions[currentQuestionIndex].cardId, isCorrect);
            }
            
            // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –≤–æ–ø—Ä–æ—Å—É —á–µ—Ä–µ–∑ 1.5 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                if (currentQuestionIndex < studyQuestions.length - 1) {
                    currentQuestionIndex++;
                    showQuestion();
                } else {
                    switchMode('cards');
                    showNotification('–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéä', 'success');
                }
            }, 1500);
        }

        function playAudioWord() {
            const currentWord = studyQuestions[currentQuestionIndex].audioWord;
            if (currentWord && speechSynthesis) {
                // –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ
                speechSynthesis.cancel();
                
                const utterance = new SpeechSynthesisUtterance(currentWord);
                utterance.lang = 'en-US';
                utterance.rate = 0.8;
                speechSynthesis.speak(utterance);
            }
        }

        function showPreviousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion();
            }
        }

        function showNextQuestion() {
            if (currentQuestionIndex < studyQuestions.length - 1) {
                currentQuestionIndex++;
                showQuestion();
            } else {
                // –ó–∞–≤–µ—Ä—à–∞–µ–º —Å–µ—Å—Å–∏—é
                switchMode('cards');
                showNotification('–°–µ—Å—Å–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞! üéä', 'success');
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
        function updateStats() {
            if (!currentSetId) return;
            
            const set = sets.find(s => s.id === currentSetId);
            if (!set) return;
            
            const total = set.cards.length;
            const difficult = set.cards.filter(card => card.userDifficulty === 'hard' || card.stats.difficulty === 2).length;
            const studied = set.cards.filter(card => card.stats.studied > 0).length;
            const success = set.stats.totalStudied > 0 ? Math.round((set.stats.correctAnswers / set.stats.totalStudied) * 100) : 0;
            const learnedProgressValue = total > 0 ? Math.round((studied / total) * 100) : 0;
            
            // SRS —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const dueCardsCount = getDueCards().length;
            const masteredCardsCount = set.cards.filter(card => card.srs && card.srs.stage >= 3).length;
            
            totalCards.textContent = total;
            learnedCards.textContent = `${studied}/${total}`;
            difficultCards.textContent = difficult;
            successRate.textContent = `${success}%`;
            learnedProgress.style.width = `${learnedProgressValue}%`;
            dueCards.textContent = dueCardsCount;
            masteredCards.textContent = masteredCardsCount;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª–æ–∂–Ω—ã–µ —Å–ª–æ–≤–∞
            if (difficult > 0) {
                difficultWordsSection.style.display = 'block';
                difficultWordsList.innerHTML = '';
                
                set.cards.filter(card => card.userDifficulty === 'hard' || card.stats.difficulty === 2).forEach(card => {
                    const wordElement = document.createElement('div');
                    wordElement.className = 'difficult-word';
                    wordElement.textContent = card.term;
                    wordElement.title = card.definition;
                    difficultWordsList.appendChild(wordElement);
                });
            } else {
                difficultWordsSection.style.display = 'none';
            }
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–æ—Ç–æ–≤—ã—Ö –Ω–∞–±–æ—Ä–æ–≤
        function showPredefinedSetsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä</h3>
                        <button class="close-btn" id="closePredefinedModal">&times;</button>
                    </div>
                    <div class="sets-list" style="max-height: 400px; overflow-y: auto;">
                        ${predefinedSets.map(set => `
                            <div class="set-item predefined-set" data-id="${set.id}">
                                <div class="set-icon">üìö</div>
                                <div style="flex: 1;">
                                    <div style="font-weight: 600;">${set.name}</div>
                                    <div style="font-size: 12px; color: var(--gray);">${set.cards.length} —Å–ª–æ–≤</div>
                                </div>
                                <button class="btn btn-primary add-set-btn">–î–æ–±–∞–≤–∏—Ç—å</button>
                            </div>
                        `).join('')}
                    </div>
                    <div class="modal-actions">
                        <button class="btn btn-secondary" id="cancelPredefined">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–∞–±–æ—Ä–æ–≤
            modal.querySelectorAll('.add-set-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    const setId = this.closest('.set-item').dataset.id;
                    addPredefinedSet(setId);
                    document.body.removeChild(modal);
                });
            });
            
            modal.querySelector('#closePredefinedModal').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            modal.querySelector('#cancelPredefined').addEventListener('click', () => {
                document.body.removeChild(modal);
            });
            
            // –ó–∞–∫—Ä—ã—Ç–∏–µ –ø–æ –∫–ª–∏–∫—É –≤–Ω–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    document.body.removeChild(modal);
                }
            });
        }

        function addPredefinedSet(setId) {
            const predefinedSet = predefinedSets.find(s => s.id === setId);
            if (!predefinedSet) return;
            
            // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é –Ω–∞–±–æ—Ä–∞ —Å –Ω–æ–≤—ã–º ID
            const newSet = {
                id: Date.now().toString(),
                name: predefinedSet.name + ' (–∫–æ–ø–∏—è)',
                cards: predefinedSet.cards.map(card => ({
                    ...card,
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                    stats: {
                        studied: 0,
                        correct: 0,
                        difficulty: 0
                    },
                    userDifficulty: 'easy',
                    srs: {
                        stage: 0,
                        interval: 1,
                        dueDate: new Date(),
                        easeFactor: 2.5,
                        reviews: 0
                    }
                })),
                stats: {
                    totalStudied: 0,
                    correctAnswers: 0,
                    difficultWords: []
                }
            };
            
            sets.push(newSet);
            saveData();
            renderSets();
            selectSet(newSet.id);
            
            showNotification(`–ù–∞–±–æ—Ä "${predefinedSet.name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω!`, 'success');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞
        function showExportModal() {
            if (!currentSetId) {
                showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–±–æ—Ä –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞', 'error');
                return;
            }
            
            updateExportContent();
            exportModal.classList.add('active');
        }

        function updateExportContent() {
            if (!currentSetId) return;
            
            const currentSet = sets.find(s => s.id === currentSetId);
            if (!currentSet) return;
            
            if (currentExportFormat === 'json') {
                const dataStr = JSON.stringify([currentSet], null, 2);
                exportContent.value = dataStr;
            } else if (currentExportFormat === 'txt') {
                const txtContent = currentSet.cards.map(card => 
                    `${card.term} - ${card.definition}`
                ).join('\n');
                exportContent.value = txtContent;
            }
        }

        function downloadExportFile() {
            if (!currentSetId) return;
            
            const currentSet = sets.find(s => s.id === currentSetId);
            if (!currentSet) return;
            
            let dataStr, fileName, mimeType;
            
            if (currentExportFormat === 'json') {
                dataStr = JSON.stringify([currentSet], null, 2);
                fileName = `think_smile_${currentSet.name.replace(/\s+/g, '_')}.json`;
                mimeType = 'application/json';
            } else if (currentExportFormat === 'txt') {
                dataStr = currentSet.cards.map(card => 
                    `${card.term} - ${card.definition}`
                ).join('\n');
                fileName = `think_smile_${currentSet.name.replace(/\s+/g, '_')}.txt`;
                mimeType = 'text/plain';
            }
            
            const dataBlob = new Blob([dataStr], {type: mimeType});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showNotification(`–ù–∞–±–æ—Ä "${currentSet.name}" —É—Å–ø–µ—à–Ω–æ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ñ–æ—Ä–º–∞—Ç–µ ${currentExportFormat.toUpperCase()}!`, 'success');
            closeExportModalFunc();
        }

        function closeExportModalFunc() {
            exportModal.classList.remove('active');
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
        function showImportModal() {
            importModal.classList.add('active');
            importFileInput.value = '';
            importPreview.style.display = 'none';
            importNameSection.style.display = 'none';
            importFileWarning.style.display = 'none';
            importNameWarning.style.display = 'none';
            confirmImport.disabled = true;
            importSetData = null;
            
            // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç –Ω–∞ JSON
            importFormatButtons.forEach(b => b.classList.remove('active'));
            document.querySelector('.import-format-btn[data-format="json"]').classList.add('active');
            currentImportFormat = 'json';
            importFileInput.accept = '.json';
        }

        function handleFileImport(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    if (currentImportFormat === 'json') {
                        handleJsonImport(e.target.result);
                    } else if (currentImportFormat === 'txt') {
                        handleTxtImport(e.target.result, file.name);
                    }
                } catch (error) {
                    importFileWarning.textContent = '–û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞: ' + error.message;
                    importFileWarning.style.display = 'block';
                    importPreview.style.display = 'none';
                    importNameSection.style.display = 'none';
                    confirmImport.disabled = true;
                }
            };
            reader.readAsText(file);
        }

        function handleJsonImport(fileContent) {
            const data = JSON.parse(fileContent);
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
            if (Array.isArray(data) && data.length > 0 && data[0].name && Array.isArray(data[0].cards)) {
                importSetData = data[0]; // –ë–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –Ω–∞–±–æ—Ä –∏–∑ —Ñ–∞–π–ª–∞
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
                previewSetName.textContent = importSetData.name;
                previewCardCount.textContent = importSetData.cards.length;
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞
                const firstWords = importSetData.cards.slice(0, 3).map(card => card.term).join(', ');
                previewFirstWords.textContent = firstWords + (importSetData.cards.length > 3 ? '...' : '');
                
                importPreview.style.display = 'block';
                importNameSection.style.display = 'block';
                importSetName.value = importSetData.name + ' (–∏–º–ø–æ—Ä—Ç)';
                validateImportName();
                importFileWarning.style.display = 'none';
            } else {
                throw new Error('–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –Ω–∞–±–æ—Ä–∞ –∫–∞—Ä—Ç–æ—á–µ–∫');
            }
        }

        function handleTxtImport(fileContent, fileName) {
            const lines = fileContent.split('\n').filter(line => line.trim());
            const cards = [];
            
            for (const line of lines) {
                // –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º —Ñ–æ—Ä–º–∞—Ç—ã: "—Å–ª–æ–≤–æ - –ø–µ—Ä–µ–≤–æ–¥" –∏–ª–∏ "—Å–ª–æ–≤–æ: –ø–µ—Ä–µ–≤–æ–¥"
                const separator = line.includes(' - ') ? ' - ' : (line.includes(': ') ? ': ' : null);
                
                if (separator) {
                    const [term, definition] = line.split(separator).map(part => part.trim());
                    if (term && definition) {
                        cards.push({
                            term: term,
                            definition: definition,
                            transcription: getTranscription(term)
                        });
                    }
                }
            }
            
            if (cards.length === 0) {
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫–∏ –≤ —Ñ–∞–π–ª–µ. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–æ—Ä–º–∞—Ç: "—Å–ª–æ–≤–æ - –ø–µ—Ä–µ–≤–æ–¥"');
            }
            
            // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –¥–ª—è –∏–º–ø–æ—Ä—Ç–∞
            const baseName = fileName.replace(/\.[^/.]+$/, ""); // –£–±–∏—Ä–∞–µ–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞
            importSetData = {
                name: baseName,
                cards: cards
            };
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–µ–≤—å—é
            previewSetName.textContent = importSetData.name;
            previewCardCount.textContent = importSetData.cards.length;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ —Å–ª–æ–≤–∞
            const firstWords = importSetData.cards.slice(0, 3).map(card => card.term).join(', ');
            previewFirstWords.textContent = firstWords + (importSetData.cards.length > 3 ? '...' : '');
            
            importPreview.style.display = 'block';
            importNameSection.style.display = 'block';
            importSetName.value = importSetData.name;
            validateImportName();
            importFileWarning.style.display = 'none';
        }

        function validateImportName() {
            const name = importSetName.value.trim();
            if (name) {
                importNameWarning.style.display = 'none';
                confirmImport.disabled = false;
            } else {
                importNameWarning.style.display = 'block';
                confirmImport.disabled = true;
            }
        }

        function confirmImportFunc() {
            if (!importSetData) return;
            
            const name = importSetName.value.trim();
            if (!name) {
                importNameWarning.style.display = 'block';
                return;
            }
            
            // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–π –Ω–∞–±–æ—Ä –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
            const newSet = {
                id: Date.now().toString(),
                name: name,
                cards: importSetData.cards.map(card => ({
                    ...card,
                    id: Date.now().toString() + Math.random().toString(36).substr(2, 9),
                    stats: {
                        studied: 0,
                        correct: 0,
                        difficulty: 0
                    },
                    userDifficulty: 'easy',
                    srs: {
                        stage: 0,
                        interval: 1,
                        dueDate: new Date(),
                        easeFactor: 2.5,
                        reviews: 0
                    }
                })),
                stats: {
                    totalStudied: 0,
                    correctAnswers: 0,
                    difficultWords: []
                }
            };
            
            sets.push(newSet);
            saveData();
            renderSets();
            selectSet(newSet.id);
            
            showNotification(`–ù–∞–±–æ—Ä "${name}" —É—Å–ø–µ—à–Ω–æ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω! –î–æ–±–∞–≤–ª–µ–Ω–æ ${newSet.cards.length} –∫–∞—Ä—Ç–æ—á–µ–∫.`, 'success');
            closeImportModalFunc();
        }

        function closeImportModalFunc() {
            importModal.classList.remove('active');
            importFileInput.value = '';
            importPreview.style.display = 'none';
            importNameSection.style.display = 'none';
            importFileWarning.style.display = 'none';
            importNameWarning.style.display = 'none';
            confirmImport.disabled = true;
            importSetData = null;
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ —É–¥–∞–ª–µ–Ω–∏—è
        function showDeleteSetModal(setId, setName) {
            deleteModalTitle.textContent = '–£–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä';
            deleteModalMessage.textContent = `–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –Ω–∞–±–æ—Ä "${setName}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`;
            deleteSetId = setId;
            confirmDeleteModal.classList.add('active');
        }

        function closeConfirmDeleteModalFunc() {
            confirmDeleteModal.classList.remove('active');
            deleteSetId = null;
        }

        function confirmDeleteFunc() {
            if (deleteSetId) {
                deleteSet(deleteSetId);
            }
        }

        function closeEditSetModalFunc() {
            editSetModal.classList.remove('active');
            editingSetId = null;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        function saveData() {
            localStorage.setItem('thinkSmileSets', JSON.stringify(sets));
        }

        function closeCreateSetModalFunc() {
            createSetModal.classList.remove('active');
            setNameInput.value = '';
            setNameWarning.style.display = 'none';
        }

        function closeCreateCardModalFunc() {
            createCardModal.classList.remove('active');
            cardTermInput.value = '';
            cardDefinitionInput.value = '';
            cardTermWarning.style.display = 'none';
            cardDefinitionWarning.style.display = 'none';
            editingCardId = null;
        }

        function showEmptyState() {
            emptyState.style.display = 'block';
            cardsContainer.style.display = 'none';
            cardsList.style.display = 'none';
            studyContainer.classList.remove('active');
            statsContainer.style.display = 'none';
            searchFilterContainer.style.display = 'none';
            viewModeSelector.style.display = 'none';
        }

        function hideEmptyState() {
            emptyState.style.display = 'none';
        }

        function showNotification(message, type = 'info') {
            // –°–æ–∑–¥–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥—ã
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        speechSynthesis.onvoiceschanged = function() {
            console.log('–ì–æ–ª–æ—Å–∞ –∑–∞–≥—Ä—É–∂–µ–Ω—ã:', speechSynthesis.getVoices().length);
        };

        // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        init();
    </script>
</body>
</html>
